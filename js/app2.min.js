$(document).foundation();var statHistory=new Array,races=new Object,blockScroll=!1;function LoadStats(t){var a=$(".mod"),e=0;$(a).each(function(){$(this).val(t[e]),e+=1}),UpdateTotals()}function LoadRaces(){$.ajax({url:"./assets/races.json",success:function(t){var a="<option value='-1'>Custom</option>";for(races=t.races,i=0;i<races.length;i++)a+="<option value='"+i+"'>"+races[i].name+"</option>";$("#raceList").html(a)}})}function RollStats(t){statHistory.length>0&&$("#undo").prop("disabled",!1);var a=new Array;for(stat=1;stat<=6;stat++){var e=0,s=new Array;switch(t){case"1":for(i=0;i<4;i++)s.push(RollDi(6));e=s.reduce(add,0),e-=Math.min.apply(null,s);break;case"2":for(i=0;i<3;i++)s.push(RollDi(6));e=s.reduce(add,0);break;case"3":var r=new Array;for(i=0;i<3;i++){for(s=new Array,i=0;i<3;i++)s.push(RollDi(6));r.push(s.reduce(add,0))}e=Math.max.apply(null,r);break;case"C":var o=20,n=1,c=0,l=0,u=$("#customRoll").val().split(",");if(u.length>0)1==(h=u[0].split("d")).length?o=parseInt(h[0]):2==h.length&&(n=parseInt(h[0]),o=parseInt(h[1]));for(i=1;i<u.length;i++)switch(u[i].substring(0,1)){case"r":c=u[i].replace("r","");break;case"l":l=u[i].replace("l","")}for(i=0;i<n;i++){var h=RollDi(o);if(c>0)for(;h<=c;)h=RollDi(o);s.push(h)}if(l>0)for(s.sort(function(t,a){return t-a}),i=0;i<l;i++)s.shift();e=s.reduce(add,0)}e,a.push(e),$("#stat_"+stat).html(e+'<i class="drag-icon fas fa-ellipsis-v"></i>')}statHistory.push(a),statHistory.length>10&&statHistory.shift(),UpdateTotals()}function RollDi(t){return parseInt(Math.floor(Math.random()*t+1))}function add(t,a){return parseInt(t)+parseInt(a)}function UpdateTotals(){var t=0;for(stat=1;stat<=6;stat++){var a=parseInt($("#stat_"+stat).html());if(t+=a,!$.isNumeric(a))break;var e=parseInt($("#mod_"+stat).val()),s=a+e;$("#total_"+stat).attr("class","callout stat-total small "+GetClass(s)).html(a+e),$("#bonus_"+stat).html(GetBonus(s))}$("#stat_total").html(t)}function GetClass(t){return t<10?"alert":t>11?"success":"primary"}function GetBonus(t){switch(t){case 1:case 2:case 3:return"-4";case 4:case 5:return"-3";case 6:case 7:return"-2";case 8:case 9:return"-1";case 10:case 11:return"0";case 12:case 13:return"+1";case 14:case 15:return"+2";case 16:case 17:return"+3";case 18:case 19:return"+4";case 20:case 21:return"+5";case 22:return"+6";default:return"0"}}LoadRaces(),$(document).ready(function(){$(window).on("touchmove",function(t){blockScroll&&t.preventDefault()}),jQuery.fn.swap=function(t){t=jQuery(t)[0];var a=this[0],e=a.parentNode.insertBefore(document.createTextNode(""),a);return t.parentNode.insertBefore(a,t),e.parentNode.insertBefore(t,e),e.parentNode.removeChild(e),this},$(".stat-base").mousedown(function(){$(this).attr("data-width",$(this).outerWidth()),$(this).attr("data-height",$(this).outerHeight())}).draggable({helper:"clone",start:function(t,a){$(a.helper).css("display","block"),$(a.helper).css("width",$(this).attr("data-width")+"px"),$(a.helper).css("height",$(this).attr("data-height")+"px"),blockScroll=!0}}),$(".stat-base").droppable({accept:".stat-base",activeClass:"ui-state-hover",hoverClass:"ui-state-active",drop:function(t,a){var e=a.draggable,s=$(this),r=$(e).html(),i=$(s).html();$(e).html(i),$(s).html(r),UpdateTotals(),blockScroll=!1}}),$("#rollAction").click(function(){RollStats($(this).attr("data-type"))}),$(".roll-stats").click(function(){$("#rollAction").html($(this).html()).attr("data-type",$(this).attr("data-type")),RollStats($(this).attr("data-type")),$("#rollOptions").foundation("close")}),$(".stat-type").change(function(){if($(this).val()!=$(this).attr("data-curr")){var t=$(this).closest("div").find(".stat-base"),a=$("#box_"+$(this).val().toLowerCase()).find(".stat-base"),e=$(a).html(),s=$(t).html();$(a).html(s),$(t).html(e),$(this).val($(this).attr("data-curr")),UpdateTotals()}}),$(".mod").blur(function(){$.isNumeric($(this).val())||$(this).val("0"),UpdateTotals()}).click(function(){$(this).select()}),$("#undo").click(function(){for(statHistory.pop(),stats=statHistory[statHistory.length-1],i=0;i<stats.length;i++)$("#stat_"+(i+1)).html(stats[i]);UpdateTotals(),1==statHistory.length&&$(this).prop("disabled",!0)}),$("#raceList").change(function(){var t="<option value='-1'>No Sub Races</option>";if(-1==$(this).val())LoadStats([0,0,0,0,0,0]);else{var a=races[$(this).val()];if(LoadStats(a.mods.split(",")),a.subRaces.length>0){t="<option value='-1'>Sub Race...</option>";for(i=0;i<a.subRaces.length;i++)t+="<option value='"+i+"'>"+a.subRaces[i].name+"</option>"}$("#raceNotes").html(a.notes)}$("#subRaceList").html(t)}),$("#subRaceList").change(function(){-1==$(this).val()?LoadStats([0,0,0,0,0,0]):LoadStats(races[$("#raceList").val()].subRaces[$(this).val()].mods.split(","))})}),function(){function t(t){var a=t.changedTouches[0],e="";switch(t.type){case"touchstart":e="mousedown";break;case"touchmove":e="mousemove";break;case"touchend":e="mouseup";break;default:return}var s=document.createEvent("MouseEvent");s.initMouseEvent(e,!0,!0,window,1,a.screenX,a.screenY,a.clientX,a.clientY,!1,!1,!1,!1,0,null),a.target.dispatchEvent(s)}document.addEventListener("touchstart",t,!0),document.addEventListener("touchmove",t,!0),document.addEventListener("touchend",t,!0),document.addEventListener("touchcancel",t,!0)}();