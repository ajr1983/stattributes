$(document).foundation();var statHistory=new Array,races=new Object;function LoadStats(t){var a=$("#modifiers").find("input"),s=0;$(a).each(function(){$(this).val(t[s]),s+=1})}function LoadRaces(){$.ajax({url:"./assets/races.json",success:function(t){var a="<option value='-1'>Custom</option>";for(races=t.races,i=0;i<races.length;i++)a+="<option value='"+i+"'>"+races[i].name+"</option>";$("#raceList").html(a)}})}function RollStats(t){var a=new Array;for(stat=1;stat<=6;stat++){var s=0;switch(t){case"1":var e=new Array;for(i=0;i<4;i++)e.push(RollDi(6));s=e.reduce(add,0),s-=Math.min.apply(null,e);break;case"2":e=new Array;for(i=0;i<3;i++)e.push(RollDi(6));s=e.reduce(add,0);break;case"3":var r=new Array;for(i=0;i<3;i++){e=new Array;for(i=0;i<3;i++)e.push(RollDi(6));r.push(e.reduce(add,0))}s=Math.max.apply(null,r)}s,a.push(s),$("#stat_"+stat).html(s)}statHistory.push(a),UpdateTotals()}function RollDi(t){return parseInt(Math.floor(Math.random()*t+1))}function add(t,a){return parseInt(t)+parseInt(a)}function UpdateTotals(){var t=0;for(stat=1;stat<=6;stat++){var a=$("#type_"+stat).val(),s=parseInt($("#stat_"+stat).html());if(t+=s,!$.isNumeric(s))break;var e=parseInt($("#"+a.toLowerCase()).val()),r=s+e;$("#total_"+stat).attr("class","callout stat-total small "+GetClass(r)).html(s+e),$("#bonus_"+stat).html(GetBonus(r))}$("#stat_total").html(t)}function GetClass(t){return t<10?"alert":t>11?"success":"primary"}function GetBonus(t){switch(t){case 1:case 2:case 3:return"-4";case 4:case 5:return"-3";case 6:case 7:return"-2";case 8:case 9:return"-1";case 10:case 11:return"0";case 12:case 13:return"+1";case 14:case 15:return"+2";case 16:case 17:return"+3";case 18:case 19:return"+4";case 20:case 21:return"+5";case 22:return"+6";default:return"0"}}LoadRaces(),$(document).ready(function(){$(".roll-stats").click(function(){RollStats($(this).attr("data-type")),statHistory.length>1&&$("#undo").prop("disabled",!1)}),$(".stat-type").change(function(){if($(this).val()!=$(this).attr("data-curr")){var t=$(this).closest("div").find(".stat-base"),a=$("#box_"+$(this).val().toLowerCase()).find(".stat-base"),s=$(a).html(),e=$(t).html();$(a).html(e),$(t).html(s),$(this).val($(this).attr("data-curr")),UpdateTotals()}}),$(".mod").blur(function(){$.isNumeric($(this).val())||$(this).val("0"),UpdateTotals()}).click(function(){$(this).select()}),$("#undo").click(function(){for(statHistory.pop(),stats=statHistory[statHistory.length-1],i=0;i<stats.length;i++)$("#stat_"+(i+1)).html(stats[i]);UpdateTotals(),1==statHistory.length&&$(this).prop("disabled",!0)}),$("#raceList").change(function(){var t="<option value='-1'>No Sub Races</option>";if(-1==$(this).val())LoadStats([0,0,0,0,0,0]);else{var a=races[$(this).val()];if(LoadStats(a.mods.split(",")),a.subRaces.length>0){t="<option value='-1'>Sub Race...</option>";for(i=0;i<a.subRaces.length;i++)t+="<option value='"+i+"'>"+a.subRaces[i].name+"</option>"}$("#raceNotes").html(a.notes)}$("#subRaceList").html(t)}),$("#subRaceList").change(function(){-1==$(this).val()?LoadStats([0,0,0,0,0,0]):LoadStats(races[$("#raceList").val()].subRaces[$(this).val()].mods.split(","))})});